<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting Started with bitfield • bitfield</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started with bitfield">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bitfield</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bitfloat/bitfield" class="external-link">
    <span class="fa fa-github"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting Started with bitfield</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bitfloat/bitfield/blob/bitfield_v1.0.0/vignettes/getting-started.Rmd" class="external-link"><code>vignettes/getting-started.Rmd</code></a></small>
      <div class="hidden name"><code>getting-started.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bitfloat/bitfield" class="external-link">bitfield</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>This guide walks through the core workflow of the
<code>bitfield</code> package: planning an encoding, choosing protocols,
finding optimal bit allocations, and sharing protocols with the
community.</p>
<div class="section level2">
<h2 id="the-example-data">The example data<a class="anchor" aria-label="anchor" href="#the-example-data"></a>
</h2>
<p>The package ships with <code>bf_tbl</code>, a small dataset with
typical quality issues (missing values, invalid coordinates, mixed
formats):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bf_tbl</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 × 5</span></span></span>
<span><span class="co">#&gt;       x     y commodity yield year </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  25.3  59.5 soybean   11.2  2021 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  27.9  58.1 maize     12.0  <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  27.8  57.8 soybean   13.2  2021r</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  27    59.2 <span style="color: #BB0000;">NA</span>         4.43 2021 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 259   <span style="color: #BB0000;">Inf</span>   honey     13.0  2021 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>  27.3  59.1 maize      8.55 2021 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>  26.1  58.4 soybean   11.3  2021 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span>  26.5 <span style="color: #BB0000;">NaN</span>   maize     10.6  2021 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">9</span>   0     0   soybean    9.01 2021</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="encoding-types-at-a-glance">Encoding types at a glance<a class="anchor" aria-label="anchor" href="#encoding-types-at-a-glance"></a>
</h2>
<p>Every bit flag uses one of a few encoding types. The table below
summarises when to use which:</p>
<table style="width:100%;" class="table">
<colgroup>
<col width="22%">
<col width="22%">
<col width="33%">
<col width="22%">
</colgroup>
<thead><tr class="header">
<th>Encoding</th>
<th>Protocol</th>
<th>Key parameters</th>
<th>Use when</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Boolean</td>
<td>
<code>na</code>, <code>inf</code>, <code>matches</code>
</td>
<td><code>set</code></td>
<td>Yes/no flags (1 bit each)</td>
</tr>
<tr class="even">
<td>Enumeration</td>
<td><code>category</code></td>
<td><code>na.val</code></td>
<td>Discrete classes (auto-sized)</td>
</tr>
<tr class="odd">
<td>Integer</td>
<td><code>integer</code></td>
<td>
<code>range</code>, <code>fields</code>
</td>
<td>Bounded values with uniform precision</td>
</tr>
<tr class="even">
<td>Floating-point</td>
<td><code>numeric</code></td>
<td>
<code>fields</code> (exp/sig)</td>
<td>Open-ended values spanning orders of magnitude</td>
</tr>
</tbody>
</table>
<p><strong>Integer encoding</strong> maps a bounded range linearly onto
bit states. Good for percentages, indices, and quantities with
well-defined limits.</p>
<p><strong>Floating-point encoding</strong> splits bits into exponent
and significand fields. Precision is finest near zero and coarsens with
magnitude. Good for standard deviations, rates, and other variables that
can span several orders of magnitude.</p>
<p>When in doubt, <code><a href="../reference/bf_analyze.html">bf_analyze()</a></code> helps decide.</p>
</div>
<div class="section level2">
<h2 id="using-bf_analyze-to-find-optimal-bit-allocations">Using bf_analyze() to find optimal bit allocations<a class="anchor" aria-label="anchor" href="#using-bf_analyze-to-find-optimal-bit-allocations"></a>
</h2>
<p><code><a href="../reference/bf_analyze.html">bf_analyze()</a></code> works with any data type. For booleans,
integers, and categories it reports the required bit count directly. For
floating-point data it evaluates all possible exponent/significand
configurations and reports those on the Pareto front for each total bit
count.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">0.1</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/bf_analyze.html">bf_analyze</a></span><span class="op">(</span><span class="va">x</span>, range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">15</span><span class="op">)</span>, max_bits <span class="op">=</span> <span class="fl">8</span>, decimals <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Float Analysis</span></span>
<span><span class="co">#&gt; ==============</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Observations      1000</span></span>
<span><span class="co">#&gt;   NA values         0</span></span>
<span><span class="co">#&gt;   Range             [0.102365, 9.98506]</span></span>
<span><span class="co">#&gt;   Levels            -</span></span>
<span><span class="co">#&gt;   Sign required     no</span></span>
<span><span class="co">#&gt;   Bits required     select from the table below</span></span>
<span><span class="co">#&gt;   Suggested na.val  automatic </span></span>
<span><span class="co">#&gt;   Target range      [0.102365, 15]</span></span>
<span><span class="co">#&gt;   Decimals          1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Exp  Sig  Total  Underflow  Overflow  Changed     Min Res     Max Res        RMSE     Max Err</span></span>
<span><span class="co">#&gt; ---  ---  -----  ---------  --------  -------  ----------  ----------  ----------  ----------</span></span>
<span><span class="co">#&gt;   2    1      3      4.2%    19.8%    95.8%      0.2500      2.0000      2.3762      6.0000</span></span>
<span><span class="co">#&gt;   2    2      4      4.2%    19.8%    91.9%      0.1250      1.0000      1.4195      4.0000</span></span>
<span><span class="co">#&gt;   3    1      4      0.7%     0.0%    94.0%      0.0625      4.0000      0.9339      2.0000</span></span>
<span><span class="co">#&gt;   2    3      5      4.2%    19.8%    84.5%      0.0625      0.5000      0.9514      3.0000</span></span>
<span><span class="co">#&gt;   3    2      5      0.7%     0.0%    89.6%      0.0312      2.0000      0.6466      2.0000</span></span>
<span><span class="co">#&gt;   4    1      5      0.0%     0.0%    93.3%      0.0312      4.0000      0.9338      2.0000</span></span>
<span><span class="co">#&gt;   2    4      6      4.2%    19.8%    70.6%      0.0312      0.2500      0.7265      2.5000</span></span>
<span><span class="co">#&gt;   3    3      6      0.7%     0.0%    80.7%      0.0156      1.0000      0.3072      1.0000</span></span>
<span><span class="co">#&gt;   4    2      6      0.0%     0.0%    88.9%      0.0156      2.0000      0.6465      2.0000</span></span>
<span><span class="co">#&gt;   2    5      7      4.2%    19.8%    56.1%      0.0156      0.1250      0.5992      2.2000</span></span>
<span><span class="co">#&gt;   3    4      7      0.7%     0.0%    65.3%      0.0078      0.5000      0.1626      0.5000</span></span>
<span><span class="co">#&gt;   4    3      7      0.0%     0.0%    80.0%      0.0078      1.0000      0.3071      1.0000</span></span>
<span><span class="co">#&gt;   2    6      8      4.2%    19.8%    40.7%      0.0078      0.0625      0.5578      2.1000</span></span>
<span><span class="co">#&gt;   3    5      8      0.7%     0.0%    48.7%      0.0039      0.2500      0.0895      0.3000</span></span>
<span><span class="co">#&gt;   4    4      8      0.0%     0.0%    64.6%      0.0039      0.5000      0.1624      0.5000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Usage:</span></span>
<span><span class="co">#&gt;   bf_map(protocol = "numeric", ...,</span></span>
<span><span class="co">#&gt;          fields = list(exponent = &lt;exp&gt;, significand = &lt;sig&gt;))</span></span></code></pre></div>
<p>The Pareto table shows multiple rows per bit count when trade-offs
exist. Key columns:</p>
<ul>
<li>
<strong>Underflow/Overflow</strong> – percentage of values outside
the representable range</li>
<li>
<strong>Changed</strong> – percentage differing after round-trip
encoding at the specified decimal precision</li>
<li>
<strong>Min/Max Res</strong> – step size at smallest and largest
representable values</li>
<li>
<strong>RMSE / Max Err</strong> – encoding error metrics</li>
</ul>
<p>For example, at 7 total bits, <code>exp=4/sig=3</code> covers the
full range (no underflow) while <code>exp=3/sig=4</code> offers finer
precision but cannot represent values below
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mrow><mo>−</mo><mn>3</mn></mrow></msup><mo>=</mo><mn>0.125</mn></mrow><annotation encoding="application/x-tex">2^{-3} = 0.125</annotation></semantics></math>.
Neither dominates the other, so both appear.</p>
<p>Use the result to pick a configuration, then pass it to
<code><a href="../reference/bf_map.html">bf_map()</a></code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># After deciding on exp=4, sig=3 based on bf_analyze() output:</span></span>
<span><span class="va">reg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bf_map.html">bf_map</a></span><span class="op">(</span>protocol <span class="op">=</span> <span class="st">"numeric"</span>, data <span class="op">=</span> <span class="va">my_data</span>, x <span class="op">=</span> <span class="va">sd_values</span>,</span>
<span>              registry <span class="op">=</span> <span class="va">reg</span>, fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>exponent <span class="op">=</span> <span class="fl">4</span>, significand <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="a-complete-example">A complete example<a class="anchor" aria-label="anchor" href="#a-complete-example"></a>
</h2>
<p>Here is a full workflow using <code>bf_tbl</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Create a registry</span></span>
<span><span class="va">reg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bf_registry.html">bf_registry</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"yield_QA"</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"Quality assessment for yield data"</span>,</span>
<span>  template <span class="op">=</span> <span class="va">bf_tbl</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Add boolean flags</span></span>
<span><span class="va">reg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bf_map.html">bf_map</a></span><span class="op">(</span>protocol <span class="op">=</span> <span class="st">"na"</span>, data <span class="op">=</span> <span class="va">bf_tbl</span>, x <span class="op">=</span> <span class="va">commodity</span>, registry <span class="op">=</span> <span class="va">reg</span><span class="op">)</span></span>
<span><span class="va">reg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bf_map.html">bf_map</a></span><span class="op">(</span>protocol <span class="op">=</span> <span class="st">"inf"</span>, data <span class="op">=</span> <span class="va">bf_tbl</span>, x <span class="op">=</span> <span class="va">x</span>, registry <span class="op">=</span> <span class="va">reg</span><span class="op">)</span></span>
<span><span class="va">reg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bf_map.html">bf_map</a></span><span class="op">(</span>protocol <span class="op">=</span> <span class="st">"inf"</span>, data <span class="op">=</span> <span class="va">bf_tbl</span>, x <span class="op">=</span> <span class="va">y</span>, registry <span class="op">=</span> <span class="va">reg</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Add a category</span></span>
<span><span class="va">reg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bf_map.html">bf_map</a></span><span class="op">(</span>protocol <span class="op">=</span> <span class="st">"category"</span>, data <span class="op">=</span> <span class="va">bf_tbl</span>, x <span class="op">=</span> <span class="va">commodity</span>,</span>
<span>              registry <span class="op">=</span> <span class="va">reg</span>, na.val <span class="op">=</span> <span class="fl">0L</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4. Add a numeric value with custom float encoding</span></span>
<span><span class="va">reg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bf_map.html">bf_map</a></span><span class="op">(</span>protocol <span class="op">=</span> <span class="st">"numeric"</span>, data <span class="op">=</span> <span class="va">bf_tbl</span>, x <span class="op">=</span> <span class="va">yield</span>,</span>
<span>              registry <span class="op">=</span> <span class="va">reg</span>, format <span class="op">=</span> <span class="st">"half"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">reg</span></span>
<span><span class="co">#&gt;   type  data.frame</span></span>
<span><span class="co">#&gt;   width 21</span></span>
<span><span class="co">#&gt;   flags 5  -|-|-|--|----------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   pos encoding  name     col</span></span>
<span><span class="co">#&gt;   1   0.0.1/0   na       commodity</span></span>
<span><span class="co">#&gt;   2   0.0.1/0   inf      x</span></span>
<span><span class="co">#&gt;   3   0.0.1/0   inf      y</span></span>
<span><span class="co">#&gt;   4   0.0.2/0   category commodity</span></span>
<span><span class="co">#&gt;   6   1.5.10/15 numeric  yield</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 5. Encode and decode</span></span>
<span><span class="va">field</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bf_encode.html">bf_encode</a></span><span class="op">(</span>registry <span class="op">=</span> <span class="va">reg</span><span class="op">)</span></span>
<span><span class="va">decoded</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bf_decode.html">bf_decode</a></span><span class="op">(</span><span class="va">field</span>, registry <span class="op">=</span> <span class="va">reg</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">decoded</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; $na_commodity</span></span>
<span><span class="co">#&gt; [1] 0 0 0 1 0 0 0 0 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $inf_x</span></span>
<span><span class="co">#&gt; [1] 0 0 0 0 0 0 0 0 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $inf_y</span></span>
<span><span class="co">#&gt; [1] 0 0 0 0 1 0 0 0 0</span></span></code></pre></div>
<div class="section level3">
<h3 id="verify-round-trip-integrity">Verify round-trip integrity<a class="anchor" aria-label="anchor" href="#verify-round-trip-integrity"></a>
</h3>
<p>Always check that the encode/decode cycle preserves essential
information:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># input NAs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">bf_tbl</span><span class="op">$</span><span class="va">commodity</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span></span>
<span><span class="co"># NAs after roundtrip</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">decoded</span><span class="op">$</span><span class="va">na_commodity</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="design-guidelines">Design guidelines<a class="anchor" aria-label="anchor" href="#design-guidelines"></a>
</h2>
<p><strong>Match precision to needs.</strong> Do not allocate 16 bits
where 5 suffice. Use <code><a href="../reference/bf_analyze.html">bf_analyze()</a></code> to quantify the
trade-off.</p>
<p><strong>Use atomic protocols.</strong> Each <code><a href="../reference/bf_map.html">bf_map()</a></code>
call should test one concept. This maximises reusability across
projects.</p>
<p><strong>Handle NA explicitly.</strong> Use the <code>na.val</code>
parameter to reserve a sentinel value for missing data. Choose a value
outside your data range (can be 0 when that value is not relevant in and
of itself, or the maximum integer state).</p>
<p><strong>Test with edge cases.</strong> Include <code>NA</code>,
<code>Inf</code>, <code>NaN</code>, zeros, and boundary values in your
test data:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">problematic</span> <span class="op">&lt;-</span> <span class="va">bf_tbl</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">8</span>, <span class="fl">9</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">problematic</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 5</span></span></span>
<span><span class="co">#&gt;       x     y commodity yield year </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  27    59.2 <span style="color: #BB0000;">NA</span>         4.43 2021 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 259   <span style="color: #BB0000;">Inf</span>   honey     13.0  2021 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  26.5 <span style="color: #BB0000;">NaN</span>   maize     10.6  2021 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>   0     0   soybean    9.01 2021</span></span></code></pre></div>
<p><strong>Choose units wisely.</strong> Livestock density in
animals/km<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>2</mn></msup><annotation encoding="application/x-tex">^2</annotation></semantics></math>
(range 0–290) needs 9 bits. The same quantity in animals/ha (range
0–3.1) needs only 5 bits. Unit choice directly affects bit budget.</p>
</div>
<div class="section level2">
<h2 id="creating-custom-protocols">Creating custom protocols<a class="anchor" aria-label="anchor" href="#creating-custom-protocols"></a>
</h2>
<p>When built-in protocols do not cover your use case, create a custom
one with <code><a href="../reference/bf_protocol.html">bf_protocol()</a></code>. For example, some datasets embed
status flags directly in value strings – a year column might contain
<code>"2021r"</code> where <code>r</code> marks the value as revised.
The built-in <code>grepl</code> protocol can detect such flags as a
boolean, but a custom protocol can distinguish <em>which</em> flag is
present:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">valueFlag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bf_protocol.html">bf_protocol</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"valueFlag"</span>,</span>
<span>  description <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Extracts trailing status flags from {x}."</span>,</span>
<span>                      <span class="st">"0 = none, 1 = r(evised), 2 = p(rovisional),"</span>,</span>
<span>                      <span class="st">"3 = e(stimated)"</span><span class="op">)</span>,</span>
<span>  test <span class="op">=</span> <span class="st">"function(x) { suffix &lt;- sub('.*([a-z])$', '\\\\1', x); match(suffix, c('r','p','e'), nomatch = 0L) }"</span>,</span>
<span>  example <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2020"</span>, <span class="st">"2021r"</span>, <span class="st">"2019p"</span>, <span class="st">"2018e"</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"int"</span>,</span>
<span>  bits <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="versioning-and-extension">Versioning and extension<a class="anchor" aria-label="anchor" href="#versioning-and-extension"></a>
</h3>
<p>When improving existing protocols, use versioning to maintain
reproducibility:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">valueFlagV2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bf_protocol.html">bf_protocol</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"valueFlag"</span>,</span>
<span>  description <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Extracts trailing status flags from {x}."</span>,</span>
<span>                      <span class="st">"0 = none, 1 = r(evised), 2 = p(rovisional),"</span>,</span>
<span>                      <span class="st">"3 = e(stimated). Now also handles uppercase flags."</span><span class="op">)</span>,</span>
<span>  test <span class="op">=</span> <span class="st">"function(x) { suffix &lt;- sub('.*([a-zA-Z])$', '\\\\1', tolower(x)); match(suffix, c('r','p','e'), nomatch = 0L) }"</span>,</span>
<span>  example <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2020"</span>, <span class="st">"2021r"</span>, <span class="st">"2019P"</span>, <span class="st">"2018e"</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"int"</span>,</span>
<span>  bits <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  version <span class="op">=</span> <span class="st">"1.1.0"</span>,</span>
<span>  extends <span class="op">=</span> <span class="st">"valueFlag_1.0.0"</span>,</span>
<span>  note <span class="op">=</span> <span class="st">"Now handles uppercase flags via case-insensitive matching"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="sharing-protocols-via-community-standards">Sharing protocols via community standards<a class="anchor" aria-label="anchor" href="#sharing-protocols-via-community-standards"></a>
</h2>
<p>The <a href="https://github.com/bitfloat/standards" class="external-link">bitfloat/standards</a>
repository enables sharing encoding protocols. Access it through
<code><a href="../reference/bf_standards.html">bf_standards()</a></code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># List available protocols</span></span>
<span><span class="fu"><a href="../reference/bf_standards.html">bf_standards</a></span><span class="op">(</span>action <span class="op">=</span> <span class="st">"list"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Pull a community protocol</span></span>
<span><span class="va">soil_protocol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bf_standards.html">bf_standards</a></span><span class="op">(</span></span>
<span>  protocol <span class="op">=</span> <span class="st">"soil_moisture"</span>,</span>
<span>  remote <span class="op">=</span> <span class="st">"environmental/soil"</span>,</span>
<span>  action <span class="op">=</span> <span class="st">"pull"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Push your own protocol</span></span>
<span><span class="fu"><a href="../reference/bf_standards.html">bf_standards</a></span><span class="op">(</span></span>
<span>  protocol <span class="op">=</span> <span class="va">dataAgeProtocol</span>,</span>
<span>  remote <span class="op">=</span> <span class="st">"environmental/temporal"</span>,</span>
<span>  action <span class="op">=</span> <span class="st">"push"</span>,</span>
<span>  version <span class="op">=</span> <span class="st">"1.0.0"</span>,</span>
<span>  change <span class="op">=</span> <span class="st">"Initial release: data age encoding for environmental monitoring"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This requires a GitHub Personal Access Token. See
<code><a href="../reference/bf_standards.html">?bf_standards</a></code> for setup instructions.</p>
</div>
<div class="section level2">
<h2 id="quick-reference">Quick reference<a class="anchor" aria-label="anchor" href="#quick-reference"></a>
</h2>
<p><strong>Do:</strong></p>
<ul>
<li>Plan your encoding before writing code</li>
<li>Use <code><a href="../reference/bf_analyze.html">bf_analyze()</a></code> for floating-point configurations</li>
<li>Test encode/decode round-trips</li>
<li>Use <code>na.val</code> for missing data</li>
<li>Keep protocols atomic (one concept each)</li>
<li>Document registries with descriptive names</li>
</ul>
<p><strong>Avoid:</strong></p>
<ul>
<li>Over-allocating bits for unnecessary precision</li>
<li>Encoding the same concept across multiple flags</li>
<li>Skipping edge case testing</li>
<li>Using floating-point encoding for bounded, uniform-precision
variables</li>
</ul>
<p>For more details, see the function documentation
(<code><a href="../reference/bf_map.html">?bf_map</a></code>, <code><a href="../reference/bf_analyze.html">?bf_analyze</a></code>,
<code><a href="../reference/bf_protocol.html">?bf_protocol</a></code>) and the package website at <a href="https://bitfloat.github.io/bitfield/" class="external-link uri">https://bitfloat.github.io/bitfield/</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://orcid.org/0000-0002-2958-0796" class="external-link">Steffen Ehrmann</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
